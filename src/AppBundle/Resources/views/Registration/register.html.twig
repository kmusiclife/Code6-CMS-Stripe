{% trans_default_domain 'message' %}

{% extends "layout.html.twig" %}
{% block title %}{{ 'registration.title.index'|trans() }}{% endblock %}

{% block fos_user_content %}
{% include "@FOSUser/Registration/register_content.html.twig" %}
{% endblock fos_user_content %}

{% block javascripts %}
<script src="https://js.stripe.com/v3/"></script>
{% endblock javascripts %}

{% block javascript %}
<script>
function stripeTokenHandler(token) {
  
  $('#submit-button').attr('disabled', 'disabled');
  $('#fos_user_registration_form_stripe_token_id').val(token.id);
  $('#payment-form').submit();
  
}
var style = {
  base: {
    fontSize: '16px',
    color: "#32325d",
  }
};

$(document).ready(function(){
	
	var stripe = Stripe('{{ stripe_public_token }}');
	var elements = stripe.elements();
	var token = $('#fos_user_registration_form_stripe_token_id').val();
	
	$('#card').show();
	var card = elements.create('card', {hidePostalCode: true, style: style});
	card.mount('#card-element');
	
	card.addEventListener('change', function(event) {
	  var displayError = document.getElementById('card-errors');
	  if (event.error) {
	    displayError.textContent = event.error.message;
	  } else {
	    displayError.textContent = '';
	  }
	});
	
	var form = document.getElementById('payment-form');
	form.addEventListener('submit', function(event) {
	  event.preventDefault();
	
	  stripe.createToken(card).then(function(result) {
	    if (result.error) {
	      var errorElement = document.getElementById('card-errors');
	      errorElement.textContent = result.error.message;
	    } else {
		  stripeTokenHandler(result.token);
	    }
	  });
	});


});
</script>

{% endblock javascript %}
